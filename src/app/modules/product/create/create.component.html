<div
  class="d-flex justify-content-center align-items-center rounded-4 border-0 bg-light"
>
  <div
    class="card shadow-lg rounded-4 border-0"
    style="min-width: 420px; max-width: 700px; width: 100%"
  >
    <div class="card-header bg-gradient bg-primary text-white border-0 py-3">
      <h4 class="mb-0 text-center fw-bold">
        <fa-icon [icon]="faBox" class="me-2"></fa-icon>Thêm Sản Phẩm
      </h4>
    </div>
    <div class="card-body p-4">
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">

        <div class="mb-4">
          <label class="form-label fw-semibold">Tên sản phẩm</label>
          <input
            type="text"
            class="form-control shadow-sm"
            placeholder="Nhập tên sản phẩm"
            formControlName="name"
            [ngClass]="{
              'is-invalid':
                productForm.get('name')?.invalid &&
                productForm.get('name')?.touched
            }"
          />
          <div class="invalid-feedback">Vui lòng nhập tên sản phẩm</div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Mã sản phẩm (SKU)</label>
            <input
              type="text"
              class="form-control shadow-sm"
              formControlName="productId"
              placeholder="Nhập mã sản phẩm (SKU)"
            />
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Mã vạch</label>
            <input
              type="text"
              class="form-control shadow-sm"
              formControlName="barcode"
              placeholder="Nhập mã vạch sản phẩm (nếu có)"
            />
          </div>
        </div>
        <div class="row mb-3 align-items-end">
          <label class="form-label fw-semibold">Khối lượng</label>
          <div class="input-group">
            <input
              type="tex"
              min="0"
              class="form-control shadow-sm"
              formControlName="weight"
              mask="separator"
              placeholder="Nhập khối lượng sản phẩm"
            />
            <span class="input-group-text fw-semibold">gram</span>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label fw-semibold">Mô tả ngắn</label>
          <textarea
            class="form-control shadow-sm"
            rows="5"
            formControlName="shortDescription"
          ></textarea>
        </div>

        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá bán lẻ</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="retailPrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá nhập</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="importPrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá sỉ</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="wholesalePrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá livestream</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="livestreamPrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá thị trường</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="marketPrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Giá Upsale</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control shadow-sm"
                mask="separator.0"
                thousandSeparator="."
                formControlName="upsalePrice"
              />
              <span class="input-group-text fw-semibold">₫</span>
            </div>
          </div>
        </div>


        <div class="mb-3">
          <label class="form-label fw-semibold">Ảnh sản phẩm</label>
          <div class="row g-2">
            <div class="col-auto">
              <label class="d-flex align-items-center justify-content-center bg-light border rounded-2 shadow-sm m-0 p-0"
                style="width: 110px; height: 110px; cursor: pointer;"
              >
                <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                  <fa-icon [icon]="faFileImage" class="fs-1 text-info mb-1"></fa-icon>
                </div>
                <input
                  type="file"
                  hidden
                  multiple
                  (change)="onImageSelected($event)"
                  accept="image/*"
                />
              </label>
            </div>
            <ng-container *ngIf="productForm.get('images')?.value">
              <ng-container *ngFor="let image of productForm.get('images')?.value; let i = index">
                <div class="col-auto">
                  <div class="position-relative bg-light border rounded-2 overflow-hidden shadow-sm"
                    style="width: 110px; height: 110px;">
                    <img
                      [src]="urlImage + image"
                      alt="Ảnh sản phẩm"
                      class="w-100 h-100 object-fit-cover"
                    />
                    <button
                      type="button"
                      class="btn btn-light btn-sm position-absolute top-0 start-0 m-1 p-0 d-flex align-items-center justify-content-center rounded-circle border"
                      style="width: 24px; height: 24px; font-size: 16px; opacity: 0.85; z-index: 2;"
                      (click)="removeImage(i)"
                      title="Xóa ảnh"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </div>
          <div
            *ngIf="productForm.get('images')?.errors?.['maxLength'] "
            class="invalid-feedback d-block"
          >
            Không thể tải thêm ảnh lên do quá số lượng tối đa cho phép (9 ảnh).
          </div>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-4">
          <button
            type="button"
            class="btn btn-outline-secondary px-4"
            (click)="goToProductList()"
          >
            Quay lại danh sách
          </button>
          <button
            type="submit"
            class="btn btn-success px-4 fw-semibold d-flex align-items-center justify-content-center"
          >
            <span
              *ngIf="isLoading"
              class="spinner-border spinner-border-sm me-2"
              role="status"
              aria-hidden="true"
            ></span>
            Thêm sản phẩm
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
