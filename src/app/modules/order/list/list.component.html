<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Danh sách đơn hàng</h2>
    <a
      class="btn btn-primary"
      (click)="openAddOrderModal(templateModalAddOrder)"
    >
      <fa-icon [icon]="faPlus"></fa-icon> Thêm
    </a>
  </div>
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th scope="col">STT</th>
          <th scope="col">Họ tên</th>
          <th scope="col">Số điện thoại</th>
          <th scope="col">Email</th>
          <th scope="col">Sản phẩm</th>
          <th scope="col">Tổng tiền</th>
          <th scope="col">Chức năng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items; let i = index">
          <th scope="row">{{ i + 1 }}</th>
          <td>{{ item.name }}</td>
          <td>{{ item.phoneNumber }}</td>
          <td>{{ item.email }}</td>
          <td>
            <ul class="list-unstyled mb-0">
              <li *ngFor="let p of item.products">
                <span class="badge bg-secondary">Mã: {{ p.productId }}</span>
                <span class="ms-2"
                  >SL: <strong>{{ p.count }}</strong></span
                >
              </li>
            </ul>
          </td>
          <td>
            <span class="fw-bold text-success">
              {{ item.totalAmount | currency : "VND" : "symbol" : "1.2" }}
            </span>
          </td>
          <td>
            <div class="d-flex gap-2">
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="openUpdateOrderModal(templateModalUpdateOrder, item)"
              >
                <fa-icon [icon]="faPenToSquare"></fa-icon> Sửa
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="openDeleteModal(templateModalDeleteOrder, item)"
              >
                <fa-icon [icon]="faTrash"></fa-icon> Xóa
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #templateModalAddOrder>
  <app-create (added)="onOrderAdded()" (closed)="modalRef?.hide()"></app-create>
</ng-template>

<ng-template #templateModalUpdateOrder>
  <app-update
    [orderId]="selectedOrder._id || ''"
    (updated)="onOrderUpdated()"
    (closed)="modalRef?.hide()"
  ></app-update>
</ng-template>

<ng-template #templateModalDeleteOrder>
  <div class="modal-header bg-danger text-white">
    <h3 class="modal-title">
      <fa-icon [icon]="faTrash"></fa-icon> Xác nhận xóa đơn hàng
    </h3>
    <button
      type="button"
      class="btn-close btn-close-white"
      aria-label="Close"
      (click)="modalRef?.hide()"
    ></button>
  </div>
  <div class="modal-body">
    <p>Bạn có chắc chắn muốn xóa đơn hàng này không?</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modalRef?.hide()">Hủy</button>
    <button class="btn btn-danger" (click)="confirmDeleteOrder()">
      <fa-icon [icon]="faTrash"></fa-icon> Xóa
    </button>
  </div>
</ng-template>
